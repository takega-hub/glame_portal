# Руководство по загрузке характеристик товаров из 1С

## Структура данных в 1С

### Основная карточка товара
- **Коллекция**: `Catalog_Номенклатура`
- **Код**: начинается с "НФ-" (например, "НФ-00001099")
- **Артикул**: обычно `null` (нет артикула у основной карточки)
- **Parent_Key**: `"00000000-0000-0000-0000-000000000000"` или `null`

### Характеристики товара
- **Коллекция**: `Catalog_Номенклатура` (те же товары, но с `Parent_Key`)
- **Код**: начинается с "НФ-" (например, "НФ-00001224")
- **Артикул**: реальный артикул характеристики (например, "KL02204004", "87010-S")
- **Parent_Key**: UUID основной карточки

### Детальные характеристики
- **Коллекция**: `Catalog_ХарактеристикиНоменклатуры`
- **Owner**: Ref_Key товара (характеристики)
- **ДополнительныеРеквизиты**: массив с полями:
  - `Свойство_Key`: ключ свойства (например, "Тип замка")
  - `Значение`: ключ значения (например, "Карабин")
  - `Значение_Type`: "StandardODATA.Catalog_ЗначенияСвойствОбъектов"

### Свойства и значения
- **Свойства**: получаются через навигацию `Catalog_ЗначенияСвойствОбъектов(guid'{value_key}')/Owner`
  - Поле `Description` или `Заголовок` содержит название свойства (например, "Тип замка")
- **Значения**: получаются из `Catalog_ЗначенияСвойствОбъектов(guid'{value_key}')`
  - Поле `Description` содержит значение (например, "Карабин")

## Формат характеристик

Характеристики сохраняются в формате:
```json
{
  "Тип замка": "Карабин",
  "Цвет": "Золотой",
  "Материал": "Сталь",
  "Вставка": "Без вставок",
  "Покрытие": "Позолота",
  "Размер": "40-70"
}
```

## Реализация

### Метод `fetch_product_characteristics`
Загружает характеристики из `Catalog_ХарактеристикиНоменклатуры`:
1. Ищет запись по `Owner` = `Ref_Key` товара
2. Получает `ДополнительныеРеквизиты`
3. Загружает значения из `Catalog_ЗначенияСвойствОбъектов`
4. Получает свойства через навигацию `Значение/Owner`
5. Формирует словарь `{"Свойство": "Значение"}`

### Интеграция в синхронизацию
В методе `sync_catalog`:
- Для каждого товара вызывается `fetch_product_characteristics`
- Характеристики объединяются с уже собранными из полей товара
- Сохраняются в `specifications` (JSON)

## Отображение на фронтенде

Характеристики отображаются на странице товара в формате:
```
Характеристики:
  Тип замка: Карабин
  Цвет: Золотой
  Материал: Сталь
  Вставка: Без вставок
  Покрытие: Позолота
  Размер: 40-70
```

## Проверка

Для проверки загрузки характеристик:
1. Запустите синхронизацию товаров
2. Проверьте поле `specifications` в БД
3. Откройте страницу товара - характеристики должны отображаться

## Примеры

### Пример основной карточки:
```json
{
  "Ref_Key": "93c6d638-b99f-11f0-836e-fa163e4cc04e",
  "Code": "НФ-00001099",
  "Description": "Kalliope",
  "Артикул": null,
  "Parent_Key": "00000000-0000-0000-0000-000000000000"
}
```

### Пример характеристики:
```json
{
  "Ref_Key": "15d539a2-ba46-11f0-836e-fa163e4cc04e",
  "Code": "НФ-00001224",
  "Description": "Браслет Kalliope жесткий с тонкими изгибами",
  "Артикул": "KL02204004",
  "Parent_Key": "93c6d638-b99f-11f0-836e-fa163e4cc04e"
}
```

### Пример характеристик из Catalog_ХарактеристикиНоменклатуры:
```json
{
  "Owner": "15d539a2-ba46-11f0-836e-fa163e4cc04e",
  "ДополнительныеРеквизиты": [
    {
      "Свойство_Key": "eeeda4b4-b9b9-11f0-836e-fa163e4cc04e",
      "Значение": "65690cb2-b9bc-11f0-836e-fa163e4cc04e"
    }
  ]
}
```

### Результат:
```json
{
  "Тип замка": "Карабин",
  "Цвет": "Золотой",
  "Материал": "Сталь"
}
```
