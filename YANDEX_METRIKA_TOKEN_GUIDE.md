# üîë –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ü–æ–ª—É—á–µ–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏

## –ú–µ—Ç–æ–¥ 1: –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

### –®–∞–≥ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π Client ID

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π Client ID –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏:

**Client ID –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** `c34ea03ded8241e6b45d82891e9b3e7f`

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**

```
https://oauth.yandex.ru/authorize?response_type=token&client_id=c34ea03ded8241e6b45d82891e9b3e7f
```

2. **–í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –Ø–Ω–¥–µ–∫—Å** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)

3. **–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º –ú–µ—Ç—Ä–∏–∫–∏

4. **–í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∫–æ–¥–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ URL:**
   
   –í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
   ```
   https://oauth.yandex.ru/verification_code#access_token=–í–ê–®–¢–û–ö–ï–ù&token_type=bearer&expires_in=31536000
   ```
   
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å—ë –º–µ–∂–¥—É `access_token=` –∏ `&token_type=`

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ:

```env
YANDEX_METRIKA_COUNTER_ID=91288073
YANDEX_METRIKA_OAUTH_TOKEN=–í–ê–®–¢–û–ö–ï–ù
```

---

## –ú–µ—Ç–æ–¥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è OAuth

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞:** https://oauth.yandex.ru/client/new

2. **–í–æ–π–¥–∏—Ç–µ** –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –Ø–Ω–¥–µ–∫—Å

3. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**
   - **–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** `GLAME Analytics` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ)
   - **–û–ø–∏—Å–∞–Ω–∏–µ:** `–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–æ–π –¥–ª—è GLAME AI platform`
   - **–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç:** `http://localhost:8000` (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
   - **–ò–∫–æ–Ω–∫–∞:** –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

4. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**
   - ‚úÖ –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É –Ω–∞ **"–í–µ–±-—Å–µ—Ä–≤–∏—Å—ã"**

5. **Callback URL (Redirect URI):**
   ```
   https://oauth.yandex.ru/verification_code
   ```
   
   –ò–ª–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
   ```
   http://localhost:3000/auth/callback
   ```

6. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (Data access):**
   
   ‚ö†Ô∏è **–í–ê–ñ–ù–û!** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–µ—Ä–∏—Ç–µ:
   - ‚úÖ `metrika:read` - **–î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏**
   
   –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - `metrika:write` - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–∞–º–∏

7. **–ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ Client ID

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- **Client ID** - –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–∑ –±—É–∫–≤ –∏ —Ü–∏—Ñ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`)
- **Client secret** - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Client ID!**

### –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç–µ Access Token

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ** (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_CLIENT_ID):

```
https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
```

–ü—Ä–∏–º–µ—Ä:
```
https://oauth.yandex.ru/authorize?response_type=token&client_id=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
```

2. **–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω** –∏–∑ URL (–∫–∞–∫ –≤ –ú–µ—Ç–æ–¥–µ 1)

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ .env

```env
YANDEX_METRIKA_COUNTER_ID=91288073
YANDEX_METRIKA_OAUTH_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∏–∑_—à–∞–≥–∞_3
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞)

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ backend/.env**

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:**

```powershell
cd "C:\GLAME AI platform"
backend\venv\Scripts\python.exe test_yandex_metrika.py
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ (–≤–∏–∑–∏—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ç.–¥.) - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!
   - ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 403 - —Ç–æ–∫–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç—ë–∫
   - ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401 - –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—á—ë—Ç—á–∏–∫—É

---

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://oauth.yandex.ru/client/my

2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ—Ç–º–µ—á–µ–Ω–æ:
   - ‚úÖ `metrika:read`

4. –ï—Å–ª–∏ –ø—Ä–∞–≤ –Ω–µ—Ç - –ø–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

---

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "Invalid oauth_token" (403)

**–ü—Ä–∏—á–∏–Ω—ã:**
- –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –æ–±—ã—á–Ω–æ 1 –≥–æ–¥)
- –¢–æ–∫–µ–Ω –±—ã–ª –æ—Ç–æ–∑–≤–∞–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω —Ç–æ–∫–µ–Ω (–ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã/—Å–∏–º–≤–æ–ª—ã)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ .env –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤:
  ```env
  YANDEX_METRIKA_OAUTH_TOKEN=—Ç–æ–∫–µ–Ω_–±–µ–∑_–ø—Ä–æ–±–µ–ª–æ–≤
  ```

### –û—à–∏–±–∫–∞: "No access to counter" (403)

**–ü—Ä–∏—á–∏–Ω—ã:**
- –£ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—á—ë—Ç—á–∏–∫—É #91288073
- Counter ID –Ω–µ–≤–µ—Ä–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ https://metrika.yandex.ru
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Counter ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –û—à–∏–±–∫–∞: "Insufficient scope" (403)

**–ü—Ä–∏—á–∏–Ω—ã:**
- –¢–æ–∫–µ–Ω –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ `metrika:read`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∞–º–∏ `metrika:read`
- –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

---

## üìù –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ .env —Ñ–∞–π–ª–∞

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/glame

# JWT
JWT_SECRET_KEY=your-secret-key

# OpenAI
OPENAI_API_KEY=sk-...

# –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞
YANDEX_METRIKA_COUNTER_ID=91288073
YANDEX_METRIKA_OAUTH_TOKEN=y0_AgAAAAAB1C2dAAtV6wAAAAD...–¥–ª–∏–Ω–Ω–∞—è_—Å—Ç—Ä–æ–∫–∞...xyz123
```

---

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:**
   ```powershell
   backend\venv\Scripts\python.exe test_yandex_metrika.py
   ```

2. **–ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend: `uvicorn app.main:app --reload`
   - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/analytics
   - –ù–∞–∂–º–∏—Ç–µ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å" –Ω–∞ –ø–∞–Ω–µ–ª–∏ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞

3. **–ì–æ—Ç–æ–≤–æ!** –î–∞–Ω–Ω—ã–µ –Ω–∞—á–Ω—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è üéâ

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OAuth –Ø–Ω–¥–µ–∫—Å–∞:** https://yandex.ru/dev/id/doc/ru/
- **API –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏:** https://yandex.ru/dev/metrika/doc/api2/intro.html
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** https://oauth.yandex.ru/client/new
- **–ú–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** https://oauth.yandex.ru/client/my
- **–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞:** https://metrika.yandex.ru

---

## üéØ –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Counter ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (91288073)
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ .env –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –∫–∞–≤—ã—á–µ–∫ –∏–ª–∏ –ø—Ä–æ–±–µ–ª–æ–≤
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

**–í—Å—ë –µ—â—ë –ø—Ä–æ–±–ª–µ–º—ã?** –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –∏ –ø–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ –≤—ã–≤–æ–¥ - –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! üöÄ
