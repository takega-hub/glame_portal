# –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –ø–æ–∫—É–ø–æ–∫ –∫ –∫–∞—Ç–∞–ª–æ–≥—É GLAME

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫ 1–° –∫ —Ç–æ–≤–∞—Ä–∞–º –≤ –∫–∞—Ç–∞–ª–æ–≥–µ GLAME –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫
- –°—Ç—Ä–æ–∏—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∫—É–ø–æ–∫

–ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫ –∏–∑ 1–°:

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞ –∏–∑ 1–°**
   - –ü–æ `–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞_Key` –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ `Catalog_–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∞—Ä—Ç–∏–∫—É–ª (`Code` –∏–ª–∏ `–ê—Ä—Ç–∏–∫—É–ª`)
   - –ü–æ–ª—É—á–∞—é—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –±—Ä–µ–Ω–¥

2. **–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ GLAME**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü–æ–∏—Å–∫ –ø–æ `external_id` (ID —Ç–æ–≤–∞—Ä–∞ –≤ 1–°)
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É (`article` –∏–ª–∏ `external_code`)
   - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–≤—è–∑—å —á–µ—Ä–µ–∑ `product_id`

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
   - –ê—Ä—Ç–∏–∫—É–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `purchase_history.product_article`
   - –°–≤—è–∑—å —Å —Ç–æ–≤–∞—Ä–æ–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `purchase_history.product_id`
   - –î–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –±—Ä–µ–Ω–¥) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

### 2. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

–ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—è:

- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –±—Ä–µ–Ω–¥—ã**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ GLAME (–µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–∏–≤—è–∑–∞–Ω), –∏–Ω–∞—á–µ - –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–∫—É–ø–∫–∏
- **–õ—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã**: –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ID —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ GLAME –≤ `purchase_preferences.favorite_products`
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 1–°
ONEC_PRODUCTS_ENDPOINT=/Catalog_–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞
```

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫—É `product_article` –≤ —Ç–∞–±–ª–∏—Ü—É `purchase_history`:

```bash
cd backend
.\venv\Scripts\python.exe add_product_article_column.py
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Alembic:

```bash
cd backend
alembic upgrade head
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–∞—Ç–∞–ª–æ–≥—É:

```bash
cd backend
.\venv\Scripts\python.exe run_customer_sync_once.py
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" –≤ —Ä–∞–∑–¥–µ–ª–µ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏".

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü–æ–∫—É–ø–∫–∏ —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
SELECT 
    ph.id,
    ph.product_article,
    ph.product_id,
    p.name as product_name,
    p.article as catalog_article
FROM purchase_history ph
LEFT JOIN products p ON ph.product_id = p.id
WHERE ph.product_id IS NOT NULL
LIMIT 10;
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### PurchaseHistory

- `product_id` - UUID —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ GLAME (–µ—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω)
- `product_id_1c` - ID –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –≤ 1–°
- `product_article` - –ê—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞ (–¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–∏–≤—è–∑–∫–∏)
- `product_name` - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏
- `category` - –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞
- `brand` - –ë—Ä–µ–Ω–¥ —Ç–æ–≤–∞—Ä–∞

### User.purchase_preferences

```json
{
  "favorite_categories": ["–ö–∞—Ç–µ–≥–æ—Ä–∏—è1", "–ö–∞—Ç–µ–≥–æ—Ä–∏—è2"],
  "favorite_brands": ["–ë—Ä–µ–Ω–¥1", "–ë—Ä–µ–Ω–¥2"],
  "favorite_products": ["uuid-—Ç–æ–≤–∞—Ä–∞-1", "uuid-—Ç–æ–≤–∞—Ä–∞-2"],  // ID —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
  "category_amounts": {"–ö–∞—Ç–µ–≥–æ—Ä–∏—è1": 50000},
  "brand_amounts": {"–ë—Ä–µ–Ω–¥1": 30000}
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–¢–æ—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: –ú–æ–∂–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫
3. **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤**: –í–∏–¥–Ω–æ, –∫–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø–æ–∫—É–ø–∞—é—Ç —á–∞—â–µ
4. **–°–≤—è–∑—å —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º**: –ü–æ–∫—É–ø–∫–∏ —Å–≤—è–∑–∞–Ω—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∞–Ω–∞–ª–∏–∑

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –¢–æ–≤–∞—Ä—ã –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞—Ä—Ç–∏–∫—É–ª —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, –ø–æ–∫—É–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏
- –î–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ–∫—É–ø–æ–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–≤—è–∑–∫—É —Ç–æ–≤–∞—Ä–æ–≤
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `favorite_products` –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
