# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö FTP –º–∞–≥–∞–∑–∏–Ω–æ–≤

## –û–±–∑–æ—Ä

–°–∫—Ä–∏–ø—Ç `sync_ftp_stores.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø–æ—Å–µ—â–µ–Ω–∏–π –∏–∑ FTP —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã GLAME AI.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

‚úÖ **–£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- –°–æ–∑–¥–∞–Ω–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤: 2 (CENTRUM, YALTA)
- –û–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 7597
- –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: 134

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (backend/.env)

```env
# FTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
FTP_HOST=5.101.179.47
FTP_USERNAME=–≤–∞—à_–ª–æ–≥–∏–Ω
FTP_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
FTP_DIRECTORY=/

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://glame_user:glame_password@localhost:5433/glame_db
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ FTP

```
/
‚îú‚îÄ‚îÄ CENTRUM/
‚îÇ   ‚îú‚îÄ‚îÄ 251201.txt
‚îÇ   ‚îú‚îÄ‚îÄ 251202.txt
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ YALTA/
    ‚îú‚îÄ‚îÄ 251125.txt
    ‚îú‚îÄ‚îÄ 251126.txt
    ‚îî‚îÄ‚îÄ ...
```

### 3. –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤

–§–∞–π–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö: `.txt`, `.csv`, `.json`, `.xml`

#### –ü—Ä–∏–º–µ—Ä TXT —Ñ–∞–π–ª–∞:
```
date,visitors,sales,revenue
2026-01-01,150,25,15000
```

#### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ TXT —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π):
```
150
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
python sync_ftp_stores.py
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—á–µ—Ä–µ–∑ cron/–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)

#### Windows (Task Scheduler)
1. –û—Ç–∫—Ä–æ–π—Ç–µ "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π"
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
3. –î–µ–π—Å—Ç–≤–∏–µ: `python C:\GLAME AI platform\sync_ftp_stores.py`
4. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00

#### Linux (cron)
```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
0 2 * * * cd /path/to/GLAME\ AI\ platform && python sync_ftp_stores.py >> logs/ftp_sync.log 2>&1
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ FTP**: –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ .env
2. **–û–±—Ö–æ–¥ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π**: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –ø–∞–ø–∫–∞–º –º–∞–≥–∞–∑–∏–Ω–æ–≤ (CENTRUM, YALTA)
3. **–ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤**: –ß–∏—Ç–∞–µ—Ç –∏ –ø–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª—ã —Å—á–µ—Ç—á–∏–∫–æ–≤ (.txt, .csv, .json, .xml)
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**: 
   - –°–æ–∑–¥–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
   - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ (–ø–æ store_id + date)

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `stores`
```sql
id            UUID PRIMARY KEY
name          VARCHAR(255) NOT NULL
city          VARCHAR(100)
is_active     BOOLEAN DEFAULT TRUE
created_at    TIMESTAMP
```

### –¢–∞–±–ª–∏—Ü–∞ `store_visits`
```sql
id             UUID PRIMARY KEY
store_id       UUID REFERENCES stores(id)
date           DATE NOT NULL
visitor_count  INTEGER DEFAULT 0
sales_count    INTEGER DEFAULT 0
revenue        FLOAT DEFAULT 0.0
created_at     TIMESTAMP
UNIQUE(store_id, date)
```

## –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ API:

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤
curl http://localhost:8000/api/analytics/stores

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
curl http://localhost:8000/api/analytics/store-visits?store_id=UUID&start_date=2026-01-01&end_date=2026-02-02

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–∞–≥–∞–∑–∏–Ω—É
curl http://localhost:8000/api/analytics/store-stats?store_id=UUID&days=30
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `sync_ftp_stores.py`:

```python
# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–∞–ø–æ–∫ FTP –∏ –Ω–∞–∑–≤–∞–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω–æ–≤
STORES = {
    "CENTRUM": "CENTRUM",
    "YALTA": "YALTA",
    "NEW_STORE": "NEW_STORE"  # –î–æ–±–∞–≤—å—Ç–µ –∑–¥–µ—Å—å
}
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç —Ü–≤–µ—Ç–Ω–æ–π –ª–æ–≥ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- üü¢ [OK] - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- üîµ [INFO] - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- üü° [WARN] - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- üî¥ [ERROR] - –æ—à–∏–±–∫–∏

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª

```bash
python sync_ftp_stores.py >> logs/ftp_sync_$(date +%Y%m%d).log 2>&1
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞: "DATABASE_URL –Ω–µ –Ω–∞–π–¥–µ–Ω"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `backend/.env` —Å–æ–¥–µ—Ä–∂–∏—Ç `DATABASE_URL`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ (–Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `#`)

### –û—à–∏–±–∫–∞: "FTP connection error"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `FTP_HOST`, `FTP_USERNAME`, `FTP_PASSWORD`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ FTP —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω

### –û—à–∏–±–∫–∞: "relation 'stores' does not exist"
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: `cd backend && python create_stores_tables.py`

### –§–∞–π–ª—ã –Ω–µ –ø–∞—Ä—Å—è—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å .txt, .csv, .json, .xml)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∞—à–±–æ—Ä–¥–æ–º

–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
- `http://localhost:3000/analytics` - –≥–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥
- –í–∫–ª–∞–¥–∫–∞ "–ú–∞–≥–∞–∑–∏–Ω—ã" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–µ—â–µ–Ω–∏—è –æ—Ñ–ª–∞–π–Ω-–º–∞–≥–∞–∑–∏–Ω–æ–≤
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, –≤—ã—Ä—É—á–∫–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

```bash
cd backend
python -c "
import psycopg2
from urllib.parse import urlparse
import os
from dotenv import load_dotenv

load_dotenv()
url = os.getenv('DATABASE_URL').replace('postgresql+asyncpg://', 'postgresql://')
parsed = urlparse(url)
conn = psycopg2.connect(host=parsed.hostname, port=parsed.port, database=parsed.path[1:], user=parsed.username, password=parsed.password)
cursor = conn.cursor()
cursor.execute('SELECT COUNT(*) FROM store_visits')
print(f'Total visits: {cursor.fetchone()[0]}')
cursor.execute('SELECT name, COUNT(*) FROM stores LEFT JOIN store_visits ON stores.id = store_visits.store_id GROUP BY stores.name')
for row in cursor.fetchall():
    print(f'{row[0]}: {row[1]} visits')
cursor.close()
conn.close()
"
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `psycopg2`, `python-dotenv`, `ftplib`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å FTP —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
