# Функционал работы с образами в UI

## Обзор

В UI добавлен полный функционал для работы с образами:
- Генерация образов через AI
- Примерка образов на фото пользователя
- Анализ фото пользователя
- Одобрение сгенерированных образов
- Просмотр деталей образов

## Компоненты

### 1. LookGenerator (`/components/looks/LookGenerator.tsx`)

Компонент для генерации образов через AI.

**Функции:**
- Ввод параметров образа (стиль, настроение, персона, описание)
- Генерация образа через API
- Отображение сгенерированного образа

**Использование:**
```tsx
<LookGenerator onLookGenerated={(look) => console.log('Generated:', look)} />
```

### 2. PhotoTryOn (`/components/looks/PhotoTryOn.tsx`)

Компонент для загрузки фото и примерки образов.

**Функции:**
- Загрузка фото пользователя
- Анализ фото (цветотип, стиль, особенности)
- Примерка образа на фото
- Генерация образа с автоматической примеркой

**Использование:**
```tsx
<PhotoTryOn 
  lookId="look-id" 
  onTryOnComplete={(result) => console.log('Try-on:', result)} 
/>
```

### 3. LookCard (`/components/looks/LookCard.tsx`)

Обновленная карточка образа с новыми функциями.

**Новые функции:**
- Отображение статуса образа (AI, одобрен, на рассмотрении)
- Отображение изображения примерки (если есть)
- Кнопка примерки образа
- Кнопка одобрения образа (для AI-сгенерированных)
- Ссылки на товары в образе

**Пропсы:**
- `look` - объект образа
- `showTryOn` - показывать ли кнопку примерки (по умолчанию `true`)
- `onTryOnClick` - callback при клике на примерку

### 4. LooksPage (`/app/looks/page.tsx`)

Главная страница образов с табами.

**Табы:**
1. **Все образы** - список всех образов
2. **Генерация образа** - форма для генерации нового образа
3. **Примерка на фото** - загрузка фото и примерка

**Функции:**
- Просмотр всех образов
- Генерация новых образов
- Примерка образов на фото
- Автоматическое обновление списка после генерации

### 5. LookDetailsPage (`/app/looks/[id]/page.tsx`)

Страница детального просмотра образа.

**Функции:**
- Просмотр полной информации об образе
- Просмотр товаров в образе
- Примерка образа на фото
- Одобрение образа
- Просмотр использованных трендов

## API функции

Все API функции добавлены в `/lib/api.ts`:

### Генерация образов
```typescript
api.generateLook({
  user_id?: string;
  session_id?: string;
  style?: string;
  mood?: string;
  persona?: string;
  user_request?: string;
})
```

### Примерка образа
```typescript
api.tryOnLook(lookId: string, photo: File, userId?: string)
```

### Одобрение образа
```typescript
api.approveLook(lookId: string, userId?: string)
```

### Анализ фото
```typescript
api.analyzePhoto(photo: File)
```

### Загрузка фото пользователя
```typescript
api.uploadUserPhoto(photo: File, userId: string)
```

### Генерация образа с примеркой
```typescript
api.generateLookWithTryOn(
  request: { user_id?: string; look_id?: string; user_request?: string },
  photo: File
)
```

## Обновленные типы

В `/types/index.ts` обновлен интерфейс `Look`:

```typescript
export interface Look {
  id: string;
  name: string;
  product_ids: string[];
  style: string | null;
  mood: string | null;
  description: string | null;
  image_url: string | null;
  status?: string | null;              // Новое: draft, approved, rejected, auto_generated
  approval_status?: string | null;     // Новое: pending, approved, rejected
  try_on_image_url?: string | null;    // Новое: URL изображения с примеркой
  generation_metadata?: Record<string, any>;  // Новое: метаданные генерации
  fashion_trends?: Array<Record<string, any>>;  // Новое: использованные тренды
  client_requirements?: Record<string, any>;     // Новое: требования клиента
}
```

## Использование

### Генерация образа

1. Перейдите на страницу `/looks`
2. Откройте вкладку "Генерация образа"
3. Заполните форму (описание запроса, стиль, настроение, персона)
4. Нажмите "Сгенерировать образ"
5. После генерации образ появится в списке

### Примерка образа

1. Перейдите на страницу `/looks`
2. Откройте вкладку "Примерка на фото" или нажмите "Примерка на фото" на карточке образа
3. Загрузите ваше фото
4. (Опционально) Нажмите "Проанализировать фото" для получения рекомендаций
5. Нажмите "Примерка образа" для примерки выбранного образа
   или "Сгенерировать и примерить" для генерации нового образа с примеркой
6. Результат примерки отобразится ниже

### Одобрение образа

1. Найдите AI-сгенерированный образ (помечен меткой "AI")
2. Нажмите "Одобрить образ"
3. После одобрения образ получит статус "Одобрен"

## Интеграция с существующим функционалом

- **ChatInterface** - использует обновленный `LookCard` для отображения образов из чата со стилистом
- **Navigation** - ссылка на `/looks` уже существует в навигации
- **ProductCard** - используется для отображения товаров в образе

## Следующие шаги

Для полной функциональности можно добавить:
- Редактирование образов
- Удаление образов
- Фильтрация по статусу, стилю, настроению
- Поиск по образам
- Экспорт образа в изображение
- Поделиться образом
